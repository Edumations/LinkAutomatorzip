import { Agent } from "@mastra/core/agent";
import { createOpenAI } from "@ai-sdk/openai";
import { lomadeeTool } from "../tools/lomadeeTool";
import { telegramTool } from "../tools/telegramTool";
import {
  checkPostedProductsTool,
  markProductAsPostedTool,
  getRecentlyPostedProductsTool,
} from "../tools/productTrackerTool";

// Configura√ß√£o do OpenAI compat√≠vel com Replit AI Integrations
const openai = createOpenAI({
  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,
  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,
});

export const promoPublisherAgent = new Agent({
  name: "Promo Publisher Agent",

  instructions: `
    Voc√™ √© um especialista em Marketing Digital e Copywriting focado em promo√ß√µes rel√¢mpago no Telegram.
    
    SEU OBJETIVO:
    Criar legendas curtas, urgentes e altamente persuasivas para produtos em promo√ß√£o.
    
    DIRETRIZES DE ESTILO:
    - Use emojis chamativos (üî•, üö®, üò±, üìâ).
    - Seja direto: v√° direto ao benef√≠cio ou ao desconto.
    - Crie senso de urg√™ncia ("S√≥ hoje", "Corra", "Estoque limitad√≠ssimo").
    - N√ÉO use hashtags (#).
    - N√ÉO invente informa√ß√µes que n√£o est√£o nos dados do produto.
    
    FORMATO OBRIGAT√ìRIO:
    1. Headline (T√≠tulo curto e impactante)
    2. Nome do Produto (pode simplificar se for muito longo)
    3. Pre√ßo e Condi√ß√£o (obrigat√≥rio citar o valor)
    4. Call to Action (Chamada para clicar no link)
  `,

  // CORRE√á√ÉO: Mudamos de openai.responses("gpt-4o") para openai("gpt-4o")
  // Isso resolve o erro de compatibilidade com o AI SDK v5
  model: openai("gpt-4o"),

  tools: {
    lomadeeTool,
    telegramTool,
    checkPostedProductsTool,
    markProductAsPostedTool,
    getRecentlyPostedProductsTool,
  },
});
